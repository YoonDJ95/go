<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>회원가입</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Noto Sans KR', sans-serif;
        }
        .signup-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 30px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .email-domain-select {
            width: 150px;
        }
        .btn-primary {
            width: 100%;
            font-size: 16px;
        }
        .detailed-address {
            margin-top: 10px;
        }
    </style>
    <script>
        // 도메인 선택에 따라 직접 입력 필드 표시 여부 조정
        function toggleDomainInput() {
            const domainSelect = document.getElementById('id_email_domain');
            const customDomainInput = document.getElementById('id_custom_domain');

            if (domainSelect.value === 'custom') {
                customDomainInput.style.display = 'block';  // 직접 입력 필드 표시
                customDomainInput.value = '';  // 직접 입력 도메인 초기화
                customDomainInput.required = true;
            } else {
                customDomainInput.style.display = 'none';  // 도메인 선택 시 직접 입력 필드를 숨김
                customDomainInput.required = false;
            }
        }

        // 폼 제출 시 이메일 아이디와 도메인 결합
        function prepareEmail() {
            const emailIdInput = document.getElementById('id_email_id');
            const domainSelect = document.getElementById('id_email_domain');
            const customDomainInput = document.getElementById('id_custom_domain');
            const fullEmailInput = document.getElementById('id_email');  // 전체 이메일을 저장할 숨겨진 필드

            let emailId = emailIdInput.value.trim();
            let fullEmail = emailId;

            if (!emailId) {
                alert("이메일 아이디를 입력하세요.");
                return false;  // 폼 제출 중단
            }

            // 도메인이 'custom'인 경우 직접 입력 도메인 사용
            if (domainSelect.value === 'custom') {
                const customDomain = customDomainInput.value.trim();
                if (customDomain) {
                    fullEmail += '@' + customDomain;
                } else {
                    alert("도메인을 입력하세요.");
                    return false;  // 폼 제출 중단
                }
            } else {
                if (domainSelect.value) {
                    fullEmail += domainSelect.value;  // 선택한 도메인과 결합
                } else {
                    alert("도메인을 선택하거나 입력하세요.");
                    return false;  // 폼 제출 중단
                }
            }

            // 결합한 이메일을 숨겨진 이메일 필드에 다시 할당
            fullEmailInput.value = fullEmail;

            return true;  // 폼 제출 허용
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="signup-container">
            <button class="btn btn-secondary btn-back" onclick="window.history.back()">뒤로 가기</button>
            <h2 class="text-center">회원가입</h2>
            <form method="POST" onsubmit="return prepareEmail()" enctype="multipart/form-data">
                {% csrf_token %}
                {% include "form_errors.html" %}

                <!-- 이메일 입력 -->
                <div class="mb-3">
                    <label for="id_email_id" class="form-label">E-mail</label>
                    <div class="input-group">
                        <!-- 이메일 아이디 입력 -->
                        <input type="text" class="form-control" id="id_email_id" name="email_id" placeholder="이메일 아이디 입력" required>
                
                        <!-- @ 표시 -->
                        <span class="input-group-text">@</span>
                
                        <!-- 도메인 선택 또는 직접 입력 -->
                        <input type="text" class="form-control" id="id_custom_domain" name="custom_domain" placeholder="도메인을 입력하세요" style="display: none;">
                        <select class="form-select email-domain-select" id="id_email_domain" name="email_domain" onchange="toggleDomainInput()" required>
                            <option value="">도메인 선택</option>
                            <option value="gmail.com">gmail.com</option>
                            <option value="naver.com">naver.com</option>
                            <option value="daum.net">daum.net</option>
                            <option value="hanmail.net">hanmail.net</option>
                            <option value="nate.com">nate.com</option>
                            <option value="hotmail.com">hotmail.com</option>
                            <option value="yahoo.com">yahoo.com</option>
                            <option value="kakao.com">kakao.com</option>
                            <option value="icloud.com">icloud.com</option>
                            <option value="outlook.com">outlook.com</option>
                            <option value="custom">직접 입력</option>
                        </select>
                    </div>
                
                    <!-- 숨겨진 전체 이메일 필드 (전송 시 사용) -->
                    <input type="hidden" id="id_email" name="email">
                </div>

                <!-- 비밀번호 입력 -->
                <div class="mb-3">
                    <label for="id_password1" class="form-label">비밀번호 (숫자 4자리)</label>
                    <input type="password" class="form-control" id="id_password1" name="password1" maxlength="4" pattern="\d{4}" placeholder="비밀번호 입력" required>
                </div>

                <!-- 비밀번호 확인 -->
                <div class="mb-3">
                    <label for="id_password2" class="form-label">비밀번호 확인</label>
                    <input type="password" class="form-control" id="id_password2" name="password2" maxlength="4" placeholder="비밀번호 확인" required>
                </div>

                <!-- 성 입력 -->
                <div class="mb-3">
                    <label for="id_last_name" class="form-label">성</label>
                    <input type="text" class="form-control" id="id_last_name" name="last_name" placeholder="성을 입력하세요" required>
                </div>

                <!-- 이름 입력 -->
                <div class="mb-3">
                    <label for="id_first_name" class="form-label">이름</label>
                    <input type="text" class="form-control" id="id_first_name" name="first_name" placeholder="이름을 입력하세요" required>
                </div>

                <!-- 전화번호 입력 -->
                <div class="mb-3">
                    <label for="id_phone_number" class="form-label">전화번호</label>
                    <input type="tel" class="form-control" id="id_phone_number" name="phone_number" placeholder="전화번호를 입력하세요" required>
                </div>

                <!-- 주소 입력 -->
                <div class="mb-3">
                    <label for="id_address" class="form-label">주소</label>
                    <div class="input-group">
                        <input type="text" class="form-control" id="id_address" name="address" placeholder="주소 입력" required>
                        <button type="button" class="btn btn-outline-secondary" onclick="searchAddress()">주소 검색</button>
                    </div>
                </div>

                <!-- 상세 주소 입력 -->
                <div class="mb-3 detailed-address">
                    <label for="id_detailed_address" class="form-label">상세 주소</label>
                    <input type="text" class="form-control" id="id_detailed_address" name="detailed_address" placeholder="상세 주소 입력" required>
                </div>

                <!-- 업종 선택 -->
                <div class="mb-3">
                    <label class="form-label">업종 선택 (다중 선택 가능)</label>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business1" value="노인복지사">
                        <label class="form-check-label" for="business1">노인복지사</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business2" value="사회복지사">
                        <label class="form-check-label" for="business2">사회복지사</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business3" value="간호사">
                        <label class="form-check-label" for="business3">간호사</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business4" value="의료기술사">
                        <label class="form-check-label" for="business4">의료기술사</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business5" value="치매전문가">
                        <label class="form-check-label" for="business5">치매전문가</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business6" value="노인케어 전문가">
                        <label class="form-check-label" for="business6">노인케어 전문가</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business7" value="재활치료사">
                        <label class="form-check-label" for="business7">재활치료사</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" name="business_type" id="business8" value="기타">
                        <label class="form-check-label" for="business8">기타</label>
                    </div>
                </div>

                <button type="submit" class="btn btn-primary">회원가입</button>
            </form>
        </div>
    </div>

    <!-- 주소 검색 API 연결 -->
    <script src="http://t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        function searchAddress() {
            new daum.Postcode({
                oncomplete: function(data) {
                    var fullAddr = data.roadAddress; // 도로명 주소
                    document.getElementById('id_address').value = fullAddr;
                }
            }).open();
        }
    </script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
